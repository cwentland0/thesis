\section{Model-form Preserving Least-squares with Variable Transformation}\label{sec:mplsvt}

The recent model-form preserving least-squares with variable transformation (MP-LSVT), developed by Huang \textit{et al.}~\cite{Huang2022}, seeks to resolve the difficulties of constructing robust and accurate ROMs for multi-scale, multi-physics problems for which Galerkin and LSPG ROMs fail. This method is founded on a very simple modification of LSPG: solve the ROM residual least-squares problem with respect to the latent representation of an alternative (but physically-complete) \textit{target state} $\funcMap{\primVec}{\nonnegReals}{\ROne{\numDOF}}$. That is, construct a low-dimensional representation of the target state, which for a linear representation is written as
%
\begin{equation}\label{eq:primSolApprox}
    \begin{aligned}
        \primFunc{\timeVar} \approx \primFuncRom{\timeVar} &\defEq \primVecCent + \sum_{\dummyIdx=1}^{\numPrimModes} \primScaleVar{\dummyIdx} \primTrialVecIdx \primVarCoefIdx (\timeVar), \\
        &\defEq \primAffineMap(\timeVar).
    \end{aligned}
\end{equation}
%
Similar to the conservative variable formulation, $\primVecCent \inROne{\numDOF}$ is a constant translation vector, $\primTrial \defEq \left[\primTrialVec{1}, \; \hdots \;, \; \primTrialVec{\numPrimModes}\right] \inRTwo{\numDOF}{\numPrimModes}$ is the target state trial basis, and $\funcMap{\primVecCoef \defEq \left[\primVarCoef{1}(\timeVar), \; \hdots \;, \; \primVarCoef{\numPrimModes}(\timeVar)\right]}{\nonnegReals}{\ROne{\numPrimModes}}$ is the target latent state vector. The constant matrix $\primScale \defEq \text{diag}\left(\primScaleVar[1], \; \hdots \; , \; \primScaleVar[\numDOF]\right) \inRTwo{\numDOF}{\numDOF}$ scales the target state variables. For an autoencoder non-linear manifold representation, the encoder/decoder form is given by
%
\begin{align}
    \encoderFunc{\primVec} &\defEq \nnLayer_{\encoderVar,\primVar} \left(\primScaleInv\left[\primVec - \primVecCent\right], \nnParams^{\encoderVar}\right), \\
    \decoderFunc{\primVecCoef} &\defEq \primVecCent + \primScale \trialPrimFunc{\primVecCoef, \nnParams^{\decoderVar}}. \label{eq:decoderFuncPrim}
\end{align}
%
In either case, the trial basis or autoencoder are computed from snapshots of the target state collected from a small number of high-fidelity simulations. These are aggregated as
%
\begin{equation}\label{eq:primSnapMat}
	\primDataMatUns = \left[ \primFuncUns{\initTime}, \; \primFuncUns{\timeVar^1}, \; \hdots \; , \; \primFuncUns{\finalTime} \right] \inRTwo{\numDOF}{\numSnaps},
\end{equation}
%
where the scaled, unsteady component of the solution is defined as
%
\begin{equation}\label{eq:primUns}
	\primFuncUns{\timeVar} = \primScaleInv \left[\primFunc{\timeVar} - \primVecCent\right].
\end{equation}
%
The trial space and non-linear trial manifold are defined, respectively, by
%
\begin{alignat}{2}
    \primTrialSpace &\defEq \primVecCent + \textit{Range}\left(\primTrial\right), \qquad &&\text{(linear)}\\
    \primTrialSpace &\defEq \{\decoderFunc{\nnInputCoef} \vert \; \nnInputCoef \inROne{\numPrimModes} \}. \qquad &&\text{(non-linear)}
\end{alignat}
%

With this low-dimensional representation in hand, the conservative state can then be treated as a function of the target state,
%
\begin{equation}\label{eq:consFuncTarget}
    \consVec \defEq \consFunc{\decoderFunc{\primVecCoef}},
\end{equation}
%
and the fully-discrete ROM residual can be reframed as
%
\begin{equation}
    \resFunc{\primVecCoef^\timeIdx} \defEq \consVecRomDt(\primVecCoef^\timeIdx) - \rhsFunc{\decoderFunc{\primVecCoef^\timeIdx}, \; \timeVar} = \zeroVec.
\end{equation}
%
Again, $\consVecRomDt(\primVecCoef^\timeIdx)$ is the temporal discretization operator for the full-order conservative state, treated now as a function of the target latent state. Similarly, the non-linear functions associated with the spatial discretization $ \rhsFunc{\cdot, \; \timeVar}$ is treated as a function of the target state. The least-squares minimization of the ROM residual thus takes the form
%
\begin{equation}\label{eq:mplsvtLS}
    \primVecCoef^{\timeIdx} = \argmin{\dummyVec \inROne{\numPrimModes}} \left\Vert \resScaleInv \resFunc{\dummyVec} \right\Vert_2.
\end{equation}
%
The scaling of the ROM residual by $\resScaleInv$ remains the same, as the model equations have not changed. The primary difference is that the solution is computed as a minimization with respect to the target latent state, rather than the conservative latent state. Solution via Gauss--Newton is thus given by
%
\begin{equation}\label{eq:mplsvtLSLin}
    \delta \primVecCoef^{\newtonIdx} = \argmin{\dummyVec \inROne{\numPrimModes}} \left\Vert \resScaleInv \left[\jacobResCoefPrim^{\newtonIdx} \dummyVec - \resFunc{\primVecCoef^{\newtonIdx}}\right] \right\Vert_2,
\end{equation}
\begin{equation}
    \primVecCoef^{\newtonIdx + 1} = \primVecCoef^{\newtonIdx} + \alpha \left[ \delta \primVecCoef^{\newtonIdx} \right],
\end{equation}
%
where the ROM residual Jacobian is now computed with respect to the target latent state, defined as $\jacobResCoefPrim^\timeIdx \defEq \funcMap{\partial \resFunc{\primVecCoef^\newtonIdx} / \partial \primVecCoef}{\ROne{\numPrimModes}}{\RTwo{\numDOF}{\numPrimModes}}$. This Jacobian can similarly be decomposed as
%
\begin{align}
    \jacobResCoefPrim^{\newtonIdx} &\defEq \pde{\resFunc{\primVecCoef^{\newtonIdx}}}{\primVecRom} \pde{\primVecRom^{\newtonIdx}}{\primVecCoef}, \\
    &= \jacobResPrim^{\newtonIdx} \primScale \jacobTrialPrim^{\newtonIdx},
\end{align}
%
where $\jacobResPrim^\newtonIdx \defEq \funcMap{\partial \resFunc{\primVecCoef^\newtonIdx} / \partial \primVecRom}{\ROne{\numPrimModes}}{\RTwo{\numDOF}{\numDOF}}$ and $\jacobTrialPrim^\newtonIdx \defEq \funcMap{\partial \trialPrimFunc{\primVecCoef} / \partial \primVecCoef}{\ROne{\numPrimModes}}{\RTwo{\numDOF}{\numPrimModes}}$.

The solution of Eq.~\ref{eq:mplsvtLSLin} via the normal equations again leads to a Petrov--Galerkin projection of the form,
%
\begin{equation}
    \left[\testBasisPrim^\newtonIdx\right]^\top \testBasisPrim^{\newtonIdx} \delta \primVecCoef^{\newtonIdx} = - \left[\testBasisPrim^{\newtonIdx}\right]^\top \resScaleInv \resFunc{\primVecCoef^{\newtonIdx}},
\end{equation}
%
where the test basis is computed as
%
\begin{equation}
    \testBasisPrim^{\newtonIdx} \defEq \resScaleInv \jacobResPrim^{\newtonIdx} \jacobDecodePrim^{\newtonIdx}.
\end{equation}
%

Note that throughout this section, the subscript $\primVar$ has been used to indicate quantities associated with the target state. As noted in Eq.~\ref{eq:gemsPrimVec}, this notation is often used to refer to the primitive state, which is given by the variables
%
\begin{equation}
    \primVec \defEq \left[
    \begin{array}{ccccc;{2pt/2pt}c;{2pt/2pt}cc}
    \pressure & \velX & \velY & \velZ & \temperature & \mfSpec & \mixFrac & \progVar
    \end{array}
    \right]^\top.
\end{equation}
%
Indeed, all work utilizing the MP-LSVT method~\cite{Huang2022,Wentland2021,Huang2022a} to date has used the primitive variables as the target state. This choice has empirically generated extremely accurate ROMs for complex reacting flow systems, including two- and three-dimensional single-element rocket combustors, and a two-dimensional multi-element rocket combustor. In direct comparisons to Galerkin and LSPG ROMs, MP-LSVT vastly improves the stability and convergence of these systems. Analysis of the conditioning of the linearized least-squares solve indicates that MP-LSVT using the primitive state produces systems with much lower condition numbers than those generated by Galerkin and LSPG. The exact reason for this improved conditioning is poorly understood beyond observed trends in numerical experiments.

The primitive variables are of particular interest in that they are immediately useful to engineers in analyzing the performance of the system, and many secondary quantities can be easily computed from them. However, the generality of the MP-LSVT invites investigations of other sets of target variables. It remains to be seen whether other variable sets may generate further improvements in linear solve conditioning, or enable more accurate predictions of important physical quantities such as heat release.